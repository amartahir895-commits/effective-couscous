<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ammar Toolkit Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .blob { position: absolute; filter: blur(80px); opacity: 0.6; z-index: -1; animation: float 10s infinite alternate; }
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 50px); } }
    </style>
</head>
<body class="bg-[#0f172a] text-white h-screen flex items-center justify-center overflow-hidden relative">

    <!-- Background Blobs -->
    <div class="blob w-96 h-96 bg-purple-600 rounded-full top-0 left-0"></div>
    <div class="blob w-96 h-96 bg-blue-600 rounded-full bottom-0 right-0 animation-delay-2000"></div>

    <div class="glass p-8 rounded-2xl w-full max-w-md shadow-2xl relative z-10 mx-4">
        
        <div class="text-center mb-8">
            <div class="inline-block p-3 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 mb-4 shadow-lg">
                <i class="fas fa-layer-group text-3xl text-white"></i>
            </div>
            <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400">
                Ammar Toolkit
            </h1>
            <p class="text-gray-400 text-sm mt-2">Build your professional bio link.</p>
        </div>

        <!-- Toggle -->
        <div class="flex bg-black/40 rounded-lg p-1 mb-6">
            <button id="tab-login" class="flex-1 py-2 rounded-md text-sm font-semibold bg-gray-700 text-white shadow transition-all" onclick="toggle('login')">Login</button>
            <button id="tab-register" class="flex-1 py-2 rounded-md text-sm font-semibold text-gray-400 hover:text-white transition-all" onclick="toggle('register')">Create Page</button>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-4">
            <div class="relative">
                <i class="fas fa-user absolute left-3 top-3.5 text-gray-500"></i>
                <input type="text" id="loginName" placeholder="Page Name (e.g. ammar-pro)" class="w-full bg-black/30 border border-gray-700 rounded-lg py-3 pl-10 pr-4 focus:border-blue-500 outline-none text-sm transition" required>
            </div>
            <div class="relative">
                <i class="fas fa-lock absolute left-3 top-3.5 text-gray-500"></i>
                <input type="password" id="loginPass" placeholder="Admin Password" class="w-full bg-black/30 border border-gray-700 rounded-lg py-3 pl-10 pr-4 focus:border-blue-500 outline-none text-sm transition" required>
            </div>
            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 py-3 rounded-lg font-bold hover:scale-[1.02] transition-transform shadow-lg">
                Access Dashboard
            </button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="space-y-4 hidden">
            <div class="relative">
                <i class="fas fa-globe absolute left-3 top-3.5 text-gray-500"></i>
                <input type="text" id="regName" placeholder="Desired Page Name (e.g. Ammar Tech)" class="w-full bg-black/30 border border-gray-700 rounded-lg py-3 pl-10 pr-4 focus:border-purple-500 outline-none text-sm transition" required>
            </div>
            <div class="relative">
                <i class="fas fa-key absolute left-3 top-3.5 text-gray-500"></i>
                <input type="password" id="regPass" placeholder="Create Admin Password" class="w-full bg-black/30 border border-gray-700 rounded-lg py-3 pl-10 pr-4 focus:border-purple-500 outline-none text-sm transition" required>
            </div>
            <button type="submit" class="w-full bg-white text-gray-900 py-3 rounded-lg font-bold hover:bg-gray-200 transition-colors shadow-lg">
                Create My Toolkit
            </button>
        </form>

        <p id="msg" class="mt-4 text-center text-xs font-semibold h-4 text-transparent transition-all">...</p>
    </div>

    <script type="module">
        import { db, doc, getDoc, setDoc } from './config.js';

        window.toggle = (mode) => {
            const l = document.getElementById('loginForm');
            const r = document.getElementById('registerForm');
            const tl = document.getElementById('tab-login');
            const tr = document.getElementById('tab-register');
            
            if(mode === 'login'){
                l.classList.remove('hidden'); r.classList.add('hidden');
                tl.className = "flex-1 py-2 rounded-md text-sm font-semibold bg-gray-700 text-white shadow transition-all";
                tr.className = "flex-1 py-2 rounded-md text-sm font-semibold text-gray-400 hover:text-white transition-all";
            } else {
                l.classList.add('hidden'); r.classList.remove('hidden');
                tr.className = "flex-1 py-2 rounded-md text-sm font-semibold bg-gray-700 text-white shadow transition-all";
                tl.className = "flex-1 py-2 rounded-md text-sm font-semibold text-gray-400 hover:text-white transition-all";
            }
        };

        function sanitize(name) {
            return name.toLowerCase().trim().replace(/\s+/g, '-').replace(/[^a-z0-9-_]/g, '');
        }

        const msg = (text, color) => {
            const m = document.getElementById('msg');
            m.innerText = text;
            m.className = `mt-4 text-center text-xs font-semibold h-4 transition-all ${color}`;
        };

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const rawName = document.getElementById('regName').value;
            const id = sanitize(rawName);
            const pass = document.getElementById('regPass').value;

            if(!id) return msg("Invalid Name", "text-red-400");
            msg("Creating Page...", "text-yellow-400");

            try {
                const ref = doc(db, "pages", id);
                const snap = await getDoc(ref);
                if(snap.exists()) return msg("Name already taken", "text-red-400");

                await setDoc(ref, {
                    pageID: id,
                    originalName: rawName,
                    password: pass,
                    title: rawName,
                    description: "Welcome to my toolkit.",
                    avatar: "",
                    links: []
                });

                sessionStorage.setItem('user', id);
                msg("Success! Redirecting...", "text-green-400");
                setTimeout(() => window.location.href = 'admin.html', 1500);
            } catch(e) { console.error(e); msg("Error. Check console.", "text-red-400"); }
        });

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = sanitize(document.getElementById('loginName').value);
            const pass = document.getElementById('loginPass').value;
            msg("Verifying...", "text-yellow-400");

            try {
                const snap = await getDoc(doc(db, "pages", id));
                if(snap.exists() && snap.data().password === pass) {
                    sessionStorage.setItem('user', id);
                    window.location.href = 'admin.html';
                } else {
                    msg("Invalid Credentials", "text-red-400");
                }
            } catch(e) { console.error(e); msg("Login Error", "text-red-400"); }
        });
    </script>
</body>
</html>
